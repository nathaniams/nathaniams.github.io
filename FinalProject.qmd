---
title: "Final Project"
editor: visual
---

![](FC_StatData.png){fig-align="center" width="580"}

## Group 1:

-   Hiba Awan

-   Nathania Stephens

# [Abstract]{.underline}

# [Introduction]{.underline}

## Motivation

In 2023, there were over 30,000 arrests and close to 65,000 citations in Fairfax County. The Fairfax County boundaries, include areas such as Centreville, Chantilly, Herndon, Reston, Tysons Corner, McLean, Merrifield, George Mason, Annadale, Burke, Springfield, Alexandria, Lorton to name a few. If you live, work, or study in these areas then this project should be of interest to you. This project aims to inform Fairfax County patrons of violation, warning, and arrest trends and hopefully provide some statistical insights that is applicable.

## Goals

Provide relevant, understandable, and insightful crime patterns using several different visualization and statistical methods. Deliver clear and concise graphs and charts that help readers easily interpret and compare data. Utilize statistical learning techniques to examine data, interpret statistical significant factors, and understand associations between variables. Since the data utilized for this project is largely categorical this project focuses on techniques such as Chi-Squared Test and Logistic Regression.

# [Data]{.underline}

## Overview

The Fairfax County Police Department (FCPD) operate in eight police districts and within those districts they are broken out into smaller Police Service Areas (PSAs). In 2023, the Fairfax County Police Department had more arrest and citation than the year prior. There were more assault offenses, theft and larceny. However, there were less homicide offenses, sex offenses, robbery, and fatal crashes. FCPD makes this information and its corresponding data available on their website. \[1\]Three datasets were pulled from the Fairfax County Police Department website. They covered arrest, citations, and warnings in the year 2023. For simplicity, general definitions are provided:

-   **Arrest** - When a person is taken into custody to answer for an offense or when there is a deprivation or restraint of a person's liberty in any significant way.

-   **Citation** - Formal notice issued by law enforcement officer for a violation of law, typically related to traffic laws or other minor offenses. Typically requiring a violator to appear in court or pay a fine.

-   **Warning** - When a violation, typically minor, has been made but an officer issues a warning rather than a citation.

The data sets included between 24 and 34 variables, but many of the variables were redundant or were not applicable to the research (e.g. web_address, phone_number, name). Redundant columns and non-applicable columns were removed (Table 1). Additional columns were created from parsed information derived from original attributes, e.g. Hour of Day and Day of Month.

| Column Name | Data Type | Description                                        |
|-------------------|-------------------|----------------------------------|
| Date        | Date      | Date of Violation                                  |
| Time        | Chr       | Time of Violation                                  |
| Offense     | Chr       | Description of Violation                           |
| Gender      | Chr       | Gender of Violator                                 |
| Ethnicity   | Chr       | Hispanic or Non-Hispanic                           |
| District    | Chr       | Administrative area                                |
| Latitude    | Dbl       | Coordinates measuring north/ south of equator      |
| Longitude   | Dbl       | Coordinates measuring east/ west of prime meridian |
| Outcome     | Chr       | Result of violation, arrest, citation, or warning  |

: Table 1: Attribute table

## Limitations and Assumptions

Due to the nature of the data available from the Fairfax County Police Department website, analysis was limited to qualitative techniques. The approach taken for the project focused on predicting through qualitative responses or classification. This means that each record pulled from the Fairfax County Police Department (FCPD) would be assigned to a category or class.

While understanding local crime is the goal of this project, the data acquired only accounts for crime that was recorded by FCPD. It does not take into account crimes that were not report or any other crime that was not reported through FCPD channels.

## Cleaning and Transformation

In cases where applicable, duplicate and null values were removed. To address questions related to gender, the data needed to be standardized and correctly categorized. Column names needed to be consistent across the three datasets to merge. Gender was used over Sex. Next the column data would be transformed to consistent labels, e.g. Male, Female, and Other/Unknown. Records that included unverified or unknown were also removed in cases where they did not contribute to the overall analysis. To ensure these removals would not corrupt the analysis, proportions were examined to ensure its removal would not effect the overall results, typically less than 2% proportion. Depending on the research question, determined which datasets were merged.

# [Research Questions]{.underline}

1)  Is there an association between gender and warnings?

2)  How does time and location factor into the odds of a Citation?

3)  How do enforcement outcomes vary across districts and demographic groups?

## Research & Analysis

#### **Question 1: Is there an association between gender and warnings?**

To address this question the null and alternative hypothesis are established.

*Null Hypothesis:* There is no association between gender and violation outcome, warning or citation. This would mean that the likelihood of a violator getting a warning is independent of gender.

*Alternative Hypothesis:* There is an association between gender and violation outcome. This implies that gender affects the outcome of whether a violator is given a citation or warning.

According to the cleaned and combined dataset for warnings and citation, there was a total of 88,320 records. By looking at the counts for each outcome (citation or warning), there are a lot more citations than there are warnings given out by FCPD. This stacked bar chart also shows that males have a higher count for both categories.

```{r}
#| echo: false
#| warning: false
library(tidyverse)
library(ggplot2)
library(dplyr)
library(leaflet)
library(usmap)
library(sf)
library(readr)
library(scales)
library(tidyr)
library(lubridate)
library(pheatmap)

# Read in the raw data for Warnings and Citations
warnings = read_csv("2023_warning_data.csv", 
                         col_types = cols(Warnings_Date = col_date(format = "%m/%d/%Y"), 
                                          WEB_ADDRESS = col_skip(), PHONE_NUMBER = col_skip(), 
                                          NAME = col_skip()))

citations = read_csv("2023_citation_data.csv", 
                                col_types = cols(Date = col_date(format = "%m/%d/%Y"), 
                                                 WEB_ADDRESS = col_skip(), PHONE_NUMBER = col_skip(), 
                                                 NAME = col_skip()))

# Rename some columns
citations = citations %>%
  rename(ViolationDate = Date)

# change Gender to sex in warnings and change date column name
warnings = warnings %>%
  rename(Sex = Gender)

warnings = warnings %>%
  rename(ViolationDate = Warnings_Date)

# Adjust Citations and prepare for Merge
# Assumption that ID is the officer's ID
citations_processed = citations %>%
  mutate(
    outcome = "Citation",
    Gender = case_when(
      Sex == "M" ~ "Male",
      Sex == "F" ~ "Female",
      TRUE ~ "Other/Unknown"
    ),
    Year = year(ViolationDate),
    Month = month(ViolationDate),
    DayOfMonth = day(ViolationDate),
    Time = parse_date_time(Time, "HM"),
    data_type = "Citation"
  ) %>%
  select(
    outcome, Gender, Year, Month, DayOfMonth, ViolationDate, Time, Offense_Description = Charge,
    District = DISTRICT, Race, Ethnicity, Latitude, Longitude, OfficerID = ID, data_type
  )

# Adjust Warnings and prepare for Merge
warnings_processed = warnings %>%
  mutate(
    outcome = "Warning",
    Gender = case_when(
      Sex == "M" ~ "Male",
      Sex == "F" ~ "Female",
      TRUE ~ "Other/Unknown"
    ),
    Year = year(ViolationDate),
    Month = month(ViolationDate),
    DayOfMonth = day(ViolationDate),
    Time = parse_date_time(Time, "HM"),
    data_type = "Warning"
  ) %>%
  select(
    outcome, Gender, Year, Month, DayOfMonth, ViolationDate, Time, Offense_Description, District = DISTRICT, Race, 
    Ethnicity, Latitude = Lat, Longitude = Long, OfficerID = Officer_ID, data_type
  )

# Combined for ultimate Data coordination!
combined_wc = bind_rows(citations_processed, warnings_processed)

# Add ultimate binary outcome! 0 = Citation, 1 = Warning/ Got out of ticket
combined_wc = combined_wc %>%
  mutate(
    BinaryOutcome = ifelse(outcome == "Warning", 1,0)
  )

## Change to Title Case for District Names
combined_wc$District = tools::toTitleCase(tolower(combined_wc$District))

## Examining Unverified data
## After examination, unverified only makes up 0.0143 or 1.43% of the data set, so we will remove
## because it is a very small portion of the total proportion. 
# combined_wc %>%
#  count(District) %>%
#  mutate(Proportion = n / sum(n)) %>%
#  arrange(desc(n))

## Filter out Unverified and NA
combined_wc = combined_wc %>%
  filter(District != "Unverified")

combined_wc = combined_wc %>%
  filter(!is.na(District))

## Filter out Other/Unknown Gender
combined_wc_mf = combined_wc %>%
  filter(Gender != "Other/Unknown")


## Stacked Bar chart for Outcome and Gender
ggplot(combined_wc_mf, aes(x = outcome, fill = Gender)) +
  geom_bar() +
  labs(
    title = "Count of Outcomes by Gender",
    x = "Outcome Type",
    y = "# of Incident",
    fill = "Gender"
  ) + theme_gray() + theme(plot.title = element_text(hjust = 0.5)) + 
  scale_fill_manual(values = c("Female" = "lightpink2", "Male" = "lightsteelblue"))
```

Next, the warning rate for gender is calculated. This looks at the probability of a male or female violator receiving a Warning instead of a citation e.g. getting out of a ticket. To calculate warning rate, the number of warnings are divided by the total number of incidents.

$$
\begin{align*}
Warning Rate = \frac{\text{Number of Warnings}}{\text{Total Incidents (Warnings + Citations)}}
\end{align*}
$$

This shows a slight difference in proportion between the two genders, with females having a higher warning rate than males. In other words, females received more warnings than males. Is this difference significant or is it a result of chance or other factors? To help understand these results, the Chi-Square Test of Independence is used. The Chi-Square Test of Independence will help determine whether the variables, gender and outcome, are independent or if there is a relationship between them.

```{r}
#| echo: false
#| warning: false
## Now for some visuals: Gender Chart
## Examining the proportion of stops resulting in a Warning Vs Citation
## the Warning rate is the proportion of incidents that are warnings.
gender_warning_rate = combined_wc_mf %>%
  group_by(Gender) %>%
  summarise(
    Total_Incidents = n(),
    Warning_Rate = mean(BinaryOutcome)
  ) %>%
  ungroup()

gender_chart = ggplot(gender_warning_rate,
                      aes(x = Gender, y = Warning_Rate, fill = Gender)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::percent(Warning_Rate, accuracy = 0.1)),
            vjust = -0.5, size = 5) +
  scale_y_continuous(labels = scales::percent, limits = c(0, max(gender_warning_rate$Warning_Rate) * 1.1)) +
  labs(
    title = "Warning Rate by Gender",
    subtitle = "Proportion of stops resulting in a Warning (vs Citation)",
    x = "Gender",
    y = "Warning Rate"
  ) + theme_gray() + theme(plot.title = element_text(hjust = 0.5)) + theme(plot.subtitle = element_text(hjust = 0.5)) +
  scale_fill_manual(values = c("Female" = "lightpink2", "Male" = "lightsteelblue"))

gender_chart
```

To implement the Chi-Square Test, a contingency table is generated, which shows the distribution for gender and outcome.

$$
\chi^2 = \sum \frac{(O-E)^2}{E}
$$

| Gender | Citations | Warnings |
|--------|-----------|----------|
| Female | 20,478    | 8,777    |
| Male   | 43,657    | 15,408   |

```{r}
#| warning: false
#| include: false
## Now the Chi-Squared Test starting with the Contingency Table
contingency_tbl = combined_wc_mf %>%
  filter(Gender %in% c("Male", "Female")) %>%
  select(Gender, BinaryOutcome) %>%
  table()

chi_sq_results = chisq.test(contingency_tbl)

expected_counts = chi_sq_results$expected

```

The results of the Chi-Square test shows:

-   **Chi-Square Statistic (x-squared)**: The chi-square test statistic is 150.62. This is the discrepancy between the observed frequencies, citations and warnings, and the expected frequencies if there were no association between the gender and outcome. This is demonstrated in the below tables.

| Gender | Expected Citations | Observed Citations | Expected Warnings | Observed Warnings |
|---------------|---------------|---------------|---------------|---------------|
| Female | 21,243 | 20,478 | 8,011 | 8,777 |
| Male | 42,891 | 43,657 | 16,173 | 15,408 |

-   **Degrees of Freedom (df)**: The degree of freedom for this test is 1, which is the number of rows minus 1 multiplied by number of columns minus 1.

-   **p-value**: The p-value is 2.2e-16 which is much smaller than 0.05. This represents the probability of observing the chi-square statistic, 150.62, or more if the null hypothesis were true.

To illustrate this, a heatmap is generated showing each values contribution to the chi-square test. This easily demonstrates that female and warning had the highest percentage.

```{r}
#| echo: false
#| message: false
#| warning: false
# Heatmap
library(pheatmap)
# observed count
observed_counts = chi_sq_results$observed
# Calculated expected above.
# Calculate residuals
pearson_residuals = chi_sq_results$residuals

# Calculate contributions to chi-square statistic
contributions = (observed_counts - expected_counts)^2 / expected_counts

total_chi_square = chi_sq_results$statistic

percentage_contributions = 100 * contributions / total_chi_square
colnames(percentage_contributions) = c("Citation", "Warning")
pheatmap(percentage_contributions,
         display_numbers = TRUE,
         cluster_rows = FALSE,
         cluster_cols = FALSE,
         main = "Percentage Contribution to Chi-Square Statistic",
         fontsize = 11,
         fontsize_row = 11,
         fontsize_col = 11,
         fontsize_number = 15
         )

```

Thus the null hypothesis is rejected. The results show that there is a statistically significant association between gender and violation outcome in Fairfax County. In other words, the Chi-square test indicates that the likelihood of a violation outcome is significantly associated with gender.

#### **Question 2: How Does Time and Location Factor into the Odds of a Citations?**

For this research question, variables such as time of day, progression of week, day of month, and district are examined to determine if those variable influence an officer's decision to issue a warning or citation. For this question, arrests are excluded since it is assumed a higher threshold of danger is imminent and would allow for less use of officers' discretion.

First, to explore the likelihood of getting a citation versus a warning (outcome of a violation), the citation rate is calculated, using the following equation.

$$
\begin{align*}
Citation Rate = \frac{\text{Number of Citations}}{\text{Total Incidents (Warnings + Citations)}}
\end{align*}
$$

Then, a heatmap is generated to see if there are any patterns that would indicate trends over hours of the day and throughout the month.

```{r}
#| label: heatmap
#| message: false
#| warning: false
#| include: false
library(dplyr)
library(lubridate)
library(ggplot2)
library(scales)
library(viridis)
library(tidyr)

combined_wc_mf = combined_wc_mf %>%
  mutate(
    Hour = hour(Time),
    Minute = minute(Time),
    Time_of_day = case_when(
      Hour >= 5 & Hour < 10 ~ "Morning Rush (0500-1000)",
      Hour >= 10 & Hour < 15 ~ "Daytime (1000-1500)",
      Hour >= 15 & Hour < 19 ~ "Evening Rush (1500-1900)",
      TRUE ~ "Night/Late Night (1900-0500)"
    ) 
  )

stop_count_by_day = combined_wc_mf %>%
  group_by(DayOfMonth) %>%
  summarise(Stop_Count = n()) %>%
  ungroup()

# Make interactive heatmap using plotly
library(plotly)

heatmap_days = combined_wc_mf %>%
  group_by(DayOfMonth, Hour) %>%
  summarise(
    TotalOutcomes = n(),
    TotalCitations = sum(BinaryOutcome == 0, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  mutate(
    Citation_Rate = TotalCitations/TotalOutcomes
  ) %>%
  tidyr::complete(DayOfMonth, Hour, fill = list(TotalOutcomes = 0, Citation_Rate = 0))

# label for x-axis
all_hours = as.character(0:23)

# Convert to factor
heatmap_days$Hour = factor(heatmap_days$Hour)
heatmap_days$DayOfMonth = factor(heatmap_days$DayOfMonth)

# Text for interactive part
heatmap_days = heatmap_days %>%
  mutate(text = paste0("Hour: ", Hour, "\n", "Day: ", DayOfMonth, "\n", "Citation Rate: ",round(Citation_Rate,2)))

## trying to get all axes
plot_heatmap_discrete_axes = ggplot(
  heatmap_days, 
  aes(x = Hour, y = DayOfMonth, fill = Citation_Rate, text = text)
) +
  geom_tile(aes(width = 1, height = 1), color = "white", linewidth = 0.1) +
  scale_fill_viridis(
    option = "magma",
    direction = -1,
    name = "Citation Rate",
    labels = scales::percent
  ) +
  scale_x_discrete(name = "Hour of Day (0 = Midnight, 12 = Noon)", drop = FALSE) + 
  scale_y_discrete(drop = FALSE) + 
  labs(
    title = "Citation Rate by Day of Month and Hour of Day",
    subtitle = "Higher intensity (darker color) indicates a higher proportion of Citations",
    y = "Day of the Month"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(vjust = 0.1, hjust = 0.1),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )

ggplotly(plot_heatmap_discrete_axes, tooltip = "text")
```

```{r}
#| echo: false
#| message: false
#| warning: false
plot_heatmap_discrete_axes = ggplot(
  heatmap_days, 
  aes(x = Hour, y = DayOfMonth, fill = Citation_Rate, text = text)
) +
  geom_tile(aes(width = 1, height = 1), color = "white", linewidth = 0.1) +
  scale_fill_viridis(
    option = "magma",
    direction = -1,
    name = "Citation Rate",
    labels = scales::percent
  ) +
  scale_x_discrete(name = "Hour of Day (0 = Midnight, 12 = Noon)", drop = FALSE) + 
  scale_y_discrete(drop = FALSE) + 
  labs(
    title = "Citation Rate by Day of Month and Hour of Day",
    subtitle = "Higher intensity (darker color) indicates a higher proportion of Citations",
    y = "Day of the Month"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(vjust = 0.1, hjust = 0.1),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )

plot_heatmap_discrete_axes
```

The higher intensity or darker color areas represent a higher citation rate. During the hours of 0500-0600 (24-hour clock) the citation rate is much higher across most days of the month. This would imply that officers are less likely to issue warnings between 5am and 6am. This time also aligns with morning rush hour and higher volumes of traffic are expected. However, the same pattern of higher citation rates are not observed during evening rush hour. The heatmap also does not show higher intensities during the end of the month. Which is what we would expect to see if officers were attempting to meet monthly ticket quotas at the end of the month.

To visualize citation and warnings geospatially, a map is generated using the latitude and longitude associated to each record. While this map is helpful for understanding concentrations of citations and warning. It is misleading in show the most dominate outcomes. This is likely due to the quantity of data points overlaid on one another; however, since it is interactive areas can be zoomed in on for further insight.

```{r}
#| message: false
#| warning: false
#| include: false


Arrest2023 <- read_csv("2023_arrest_data.csv", 
                       col_types = cols(ArresteeNumber = col_skip(), 
                                        ArrestDate = col_date(format = "%m/%d/%Y"), 
                                        ArrestTime = col_character(), WEB_ADDRESS = col_skip(), 
                                        PHONE_NUMBER = col_skip(), NAME = col_skip()))

## Remove any outliers by setting min/max lat and long.
min_lat = 38.6
max_lat = 39.0
min_lon = -77.6
max_lon = -77.0

## Using all data but excluding any coordinates that are not within coordinates
arrest_data_clean = Arrest2023 %>%
  filter(
    Latitude >= min_lat,
    Latitude <= max_lat,
    Longitude >= min_lon,
    Longitude <= max_lon
  )

## Include district boundaries by reading in shape file downloaded from Fairfax County site
district_boundaries = st_read("Supervisor_Districts/Supervisor_Districts.shp")

## Transform to WGS84 projection to match basemap within leaflet
if (st_crs(district_boundaries)$epsg != 4326) {
  district_boundaries = st_transform(district_boundaries, 4326)
}
```

```{r}
#| echo: false
#| message: false
#| warning: false
## Using leaflet to map the Outcomes across Fairfax County

pal = colorFactor(
  palette = c("red", "gold1"), 
  domain = combined_wc_mf$outcome, 
  levels = c("Citation", "Warning") 
)

leaflet() %>%
  addProviderTiles(providers$OpenStreetMap) %>%
  addPolygons(
    data = district_boundaries,
    fillOpacity = 0.5,
    color = "black",
    weight = 1,
    popup = ~paste("District:", DISTRICT)
  ) %>%
  addCircleMarkers(
    data = combined_wc_mf,
    lng = ~Longitude,
    lat = ~Latitude,
    radius = 2.5,
    color = ~pal(outcome),
    stroke = FALSE,
    fillOpacity = 0.4,
    popup = ~paste(
      "Outcome: ", outcome, "<br>")
  )
```

Next, through the use of Logistic Regression, the odds ratios is examined between citations and warnings for Fairfax county. Predictor variables, time of day, week progression, day of month, district are used to predict the probability that a warning or citation will occur. The results provide an odd ratios at the intercept of 0.532 which would indicate that the odds of getting a warning are less than 50/50. In other words, if pulled over for a traffic violation, it is not a flip of a coin whether you get a ticket or not. Your chance of getting a citation is higher according to the intercept generated through this logistic regression model. Additionally, the model showed factors that did increased the likelihood of getting a warning occurred in certain districts (Mount Vernon, Mason, and Franconia) and progression of the week influences leniency. In weekly progression, an odds ratio of 1.595 shows that as the week progresses from Monday to Sunday, the odds of recieving a warning increase by 59.5 %. Alternatively, factors such as time of day and day of the month showed an increased likelihood of a citation. Using the below graph, the top five odds ratio for citation and bottom five odds ratio for warnings are depicted.

```{r}
#| message: false
#| warning: false
#| include: false
library(dplyr)
library(lubridate)
library(caTools)
library(pROC) 

#Add HourOfDay
combined_wc_mf = combined_wc_mf %>%
  mutate(
    HourOfDay = hour(Time))

combined_wc_mf = combined_wc_mf %>%
  mutate(
    DayOfWeek = factor(
      wday(ViolationDate, label = TRUE, week_start = 1),
      levels = c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun")))

model_columns_chrono = c(
  "BinaryOutcome",
  "HourOfDay",
  "DayOfMonth",
  "DayOfWeek",
  "District"
)

data_for_modeling = combined_wc_mf %>%
  select(all_of(model_columns_chrono)) %>%
  mutate(across(c(HourOfDay, DayOfMonth, DayOfWeek, District), as.factor)) %>%
  mutate(BinaryOutcome = factor(BinaryOutcome, levels = c(0, 1))) %>%
  na.omit()

data_for_modeling

set.seed(42)

sample_split_chrono = sample.split(
  Y = data_for_modeling$BinaryOutcome,
  SplitRatio = 0.70
)

train_set_chrono = subset(data_for_modeling, sample_split_chrono == TRUE)
test_set_chrono = subset(data_for_modeling, sample_split_chrono == FALSE)

logistic_model_chrono = glm(
  formula = BinaryOutcome ~ .,
  data = train_set_chrono,
  family = binomial(link = "logit")
)

odds_ratio_chrono = exp(coef(logistic_model_chrono))

odds_ratio_df_chrono = data.frame(
  Variable = names(odds_ratio_chrono),
  OddsRatio = odds_ratio_chrono
)

print(odds_ratio_df_chrono %>%
        filter(Variable != "(Intercept)") %>%
        arrange(OddsRatio) %>%
        head(30))
```

```{r}
#| echo: false
#| message: false
#| warning: false
## new visual
top_citation_chrono = odds_ratio_df_chrono %>%
  filter(Variable != "(Intercept)") %>%
  arrange(OddsRatio) %>%
  head(5) %>%
  mutate(Effect = "Stronger Citation Likelihood")

top_warning_chrono = odds_ratio_df_chrono %>%
  filter(Variable != "(Intercept)") %>%
  arrange(desc(OddsRatio)) %>%
  head(5) %>%
  mutate(Effect = "Stronger Warning Likelihood")

plot_data_chrono = bind_rows(top_citation_chrono, top_warning_chrono)

plot_data_chrono = plot_data_chrono %>%
  mutate(
    Variable = gsub("HourOfDay", "Hr:", Variable),
    Variable = gsub("DayOfMonth", "Day:", Variable),
    Variable = gsub("DayOfWeek", "Week:", Variable),
    Variable = gsub("District", "Dist:", Variable)
  )

odds_ratio_plot_chrono = ggplot(plot_data_chrono, aes(x = Variable, y = OddsRatio, fill = Effect)) +
  geom_bar(stat = "identity", position = "identity") +
  geom_hline(yintercept = 1.0, linetype = "dashed", color = "black", linewidth = 1) +
  scale_y_continuous(
    trans = 'log2', 
    breaks = c(0.3, 0.5, 0.7, 1.0, 1.5, 2.0, 2.5),
    labels = c("0.3", "0.5", "0.7", "1.0", "1.5", "2.0", "2.5")
  ) +
  labs(
    title = "Odds Ratios of Date and Location Factors on Issuing a Warning",
    subtitle = "Based on Hour, Day of Month, Day of Week, and District",
    x = "Predictor Variable",
    y = "Odds Ratio (Warning vs. Citation)",
    fill = "Enforcement Discretion"
  ) +
  scale_fill_manual(values = c("Stronger Citation Likelihood" = "coral3", "Stronger Warning Likelihood" = "gold1")) +
  
  # Flip coordinates for a horizontal bar chart (easier to read labels)
  coord_flip() +
  theme_grey(base_size = 11)

odds_ratio_plot_chrono
```

Gender and race were originally included but removed to isolate only time and space variables. Additionally, after running both models, the Area Under the Curve (AUC) increased only slightly (+ 0.0004) after removal of race and gender. This would mean that while gender and race were statistically significant, they were not as strong of predictors as date/time and district when classifying an outcome of either citation or warning. The AUC for the model that focused date/time and district was 0.6289. Which means that 63% of the citation/warning outcome is predictable using day of the month, time of day, progression of week, and district. The other 37% of the outcome is due to other factors not captured in this model. These factors could include offense type, violator's behavior, and officer variables. While not a particularly strong predictive model, the model helps understand the effects of time and location.

```{r}
#| echo: false
#| message: false
#| warning: false
## Calculate AUC
library(pROC)

probability_chrono = predict(
  logistic_model_chrono,
  newdata = test_set_chrono,
  type = "response"
)

roc_obj_chrono = roc(
  response = test_set_chrono$BinaryOutcome,
  predictor = probability_chrono,
  levels = c(0,1) 
)
auc_value_chrono = auc(roc_obj_chrono)

round(auc_value_chrono, 4)

```

#### Question 3: How do enforcement outcomes vary across districts and demographic groups?

Finally, we’ll be exploring the relationships between the outcomes of crime incidents and their district and demographic (gender, race, ethnicity) variables. Addressing this final question involved combining the three data sets of different crime outcomes: arrest data, citation data, and warning data.

(EnforcementOutcomesByDistrict)

Starting with the outcomes across different districts, we start off by performing a chi-square test to establish whether there’s a relationship between the crime outcomes and the districts they took place in.

*Null Hypothesis:* Enforcement outcome is independent of police district.

*Alternative hypothesis:* Enforcement outcome and police district are associated.

For the chi-square implementation, a contingency table for the district and outcome counts is generated: (table)

From both the visualization above and the table output, we can see that citations are the most common outcome among the districts. However, this won’t affect the test as chi-square allows unequal margin totals. The other outcomes, arrests and warnings, vary substantially in volume across districts. Some districts (like Sully, Springfield, Providence) show particularly high citation counts, while others (Braddock, Dranesville) show lower overall enforcement volumes.

Then the test is performed:

(Chi-Squared test)

The chi-square statistic is extremely large, which indicates a substantial deviation between observed and expected counts. The p-value is also low enough that we reject the null hypothesis. Therefore, there is a statistically significant association between district and enforcement outcome.

From this, we can see that enforcement severity varies by district and district-level patterns justify further modeling.

(Enforcement Outcomes by Demographics)

(results) Performing multinomial logistic regression shows that enforcement outcomes vary systematically across both police districts and demographic groups. Certain districts, such as Providence and Sully, have higher relative odds of arrest compared to citations or warnings. Race and ethnicity are also significant predictors: Black and Hispanic individuals are more likely to be arrested rather than receive less severe enforcement actions. Gender has smaller but detectable effects. These results indicate that enforcement outcomes are influenced by both location and demographic characteristics.

# [Conclusion]{.underline}

Through the research conducted in this project we were able to examine the law enforcement outcomes in Fairfax County using data from 2023. We were able to reject our null hypothesis which stated that there was no association between gender and violation outcome. Results from the Chi-Square test showed that there was a statistically significant association between gender and outcome. However, while gender was statistically significant, gender was found to be a weak predictor after running logistic regression models. Factors such as time and location had more of an influence when predicting the odds ratio of a warning versus citation. The Area Under of the Curve (AUC) for the logistic regression model was about 63% which considering the limitations of the dataset focusing specifically on time and space emphasizes the importance of time and location patterns for crime prediction. If factors such as offense type and description where used this would have very likely resulted in a stronger predictive model. While prediction was limited, this project highlights time and space trends showing odds ratio for citations between 5am and 6am were higher for receiving a citation while odds for receiving a warning increased as the week progressed. As noted, was the higher likelihood of a warning in the Mount Vernon, Mason, and Franconia districts.

# [References]{.underline}
